# What is in this repository

This is a toy repo where I create equivalent models of my thesis project. I test the files here with models that run a lot faster and are much simpler than my dodecamer one. 

There might be some files that are saved as tests outside of the main ones, as I try out different things.

The important files to run the simulation are:

## BioNetGen and MCell model files:
- [`mcell_params.py`](mcell_params.py): is the script where the PATH to mcell is defined.
- [`test_ABC.bngl`](test_ABC.bngl): where model is created and described using BNGL. 

## Run-the-model files:
- [`prepare_run_files.py`](prepare_run_files.py): script that prepares files to be copied, ran, and saved in a timestamped folder.
- [`run_python_files.py`](run_python_files.py): script executor that automates the execution of the other Python scripts.

## Output files
- `data_output/`: contains timestamped folders that are created with scripts mentioned above. Each timestamped folder contains the outputs from running the python scripts.

# How to use files in this repo

## 1. Install MCell/CellBlender v4.0.6 bundle with Blender 2.93
To run the model files, you will need MCell. The CellBlender bundle containing MCell4 is available for download for different operating systems at the MCell.org website: https://mcell.org/download.html

As of 20230428 I used MCell/CellBlender v4.0.6 bundle with Blender 2.93, on Windows 10 to run this code.

As of 20230501 MCell MacOS Download isn't compatible with "Apple Silicone" devices; it looks like MCell is incompatible with the latest Mac hardware, which uses Arm chips.

I use VS Code as my IDE (Integrated development environment), but you can use whichever IDE you prefer. 

-  To save time and computational power, I run MCell4 outside of Blender.

-  To use MCell4 outside of Blender with Python 3.9, additional installation steps are required as described below:

## 2. Setting System Variable MCELL_PATH and adding Python 3.9 to PATH

### 2.1. Depending on your OS:

In order to set the System Variable MCELL_PATH, depeding on your Operating System, please follow the instructions here: https://mcell.org/mcell4_documentation/installation.html#setting-system-variables

### 2.2. Why do you need to do this:
As per the mcell documentation, MCell4 Python models use the system variable MCELL_PATH to locate the MCell4 library. It is also useful as a shortcut to the location of utility scripts contained in the CellBlender bundle.

MCell4 also requires Python 3.9. You can either use you own installation or set the system variable PATH so that the Python included in the CellBlender bundle is found.

The models generated by CellBlender expect a system variable MCELL_PATH to be defined and use it to add this path (appended with ‘lib’) to the Python’s search paths like this: 

This is specified in the python files that need to access mcell when running; in this case it's in [`mcell_params.py`](mcell_params.py).

```python
MCELL_PATH = os.environ.get('MCELL_PATH', '')
sys.path.append(os.path.join(MCELL_PATH, 'lib'))

import mcell as m
```

## 3. Set up a python environment
In order to make sure we are both working with the same versions of python and dependencies required to run the python script in this repo, it will be useful to create an environment.

With a virtual environment, it’s possible to retain all the information in our projects like the dependencies, so anyone else can duplicate the same environment we’re working with.

### 3.1. If you have conda (the environment management system I use): 

You can use the [environment.yml](./environment.yml) file in this repo, and create an environment with the following command:

```
conda env create --file environment.yml
```

This will create an environment called *'camkii-project-env'*. Then activate the environment and run the [mcell_hexamer.py](./mcell_hexamer.py) file there.

PS. I have found [these carpentries](https://carpentries-incubator.github.io/introduction-to-conda-for-data-scientists/) quite helpful with queries regarding conda environments, if you need some guidance here. 

### 3.2. If you use a different environment manager:

You will likely need to use the [requirements.txt](./requirements.txt) file instead. 

The commands to create and activate an environment using virtualenv, pipenv, venv, pyenv, etc will be different depending on which one you use. As an example, if you were using [venv](https://docs.python.org/3/library/venv.html), then you would need to do something like this:

```virtualenv my-env ``` to create your new environment (called 'my-env' here)

```source my-env/bin/activate``` to enter the virtual environment

```pip install -r requirements.txt``` to install the requirements in the current environment

## Step 1
Have a look at the [`test_ABC.bngl`](test_ABC.bngl) file, are you happy with the parameters being used? 

Would you like to change something? You can make changes in this file, which will then be accessed via [`prepare_run_files.py`](prepare_run_files.py) to load its parameters and run them through mcell. More information on how this works can be found in this documentation [Loading a BNGL File](https://mcell.org/mcell4_documentation/bngl.html)

## Step 2
Once you are happy with parameters set in the .bngl file, go to the [`mcell_params.py`](mcell_params.py) file. You can change parameters in here too, if necessary. These are also accessed via [`prepare_run_files.py`](prepare_run_files.py).

## Step 3
After making sure parameters are all set up, the [`prepare_run_files.py`](prepare_run_files.py) file prepares a timestamped folder where a copy of the used files above are saved. It also saves visualisation data and a parameters.csv file that contains parameters extracted from the .bngl file used. 

You do not need to do anything here, but it is useful to have a look at what this file looks like to understand what is happening when the ode is being run. 

## Step 4
Run the following in your command line:

```python
python run_python_files.py
```

This works python magic to action all the instructions given in the other python scripts.